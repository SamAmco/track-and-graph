TODO: 
- Throw if you try to create a function that does not declare all of its data sources somehow to ensure cycles are impossible
- Although you can't select a feature that creates a cycle, the default selected item might create a cycle
- Probably detect global cycles and throw in the data module in case there are non-compliant future clients
- Show a dialog when you first enter the function screen that explains it's advanced and links to the docs
- Add a help button on the function screen that links to the docs?
- Add text to the grid that hints at going landscape
- Add text to the grid that hints at long pressing to add a node
- Fix up the function card UI. Min height should be the same as tracker
- Improve function card UI in general
- Docs

QA: 
  - Removing a function should remove it from any graphs that use it as a data source
  - Removing a data source should remove it from any functions that use it as a data source
  - Adding a function that creates a cycle should be prevented
  - Create nested complex dependent functions and use them in lots of graphs in the same screen and scroll
  - Publish the functions and make sure they work in prod
  - Disable internet and make sure cache hits anyway for functions
  - Double check url navigation is still working because i changed some stuff there
  - Check what happens on signature and network failure when downloading functions


FUNCTIONS PLANNING

User adds function
Comes to function screen
Configures function
Saves function
User sees function in group

User edits function
Comes to function screen
Edits function
Saves function
User sees function in group

User deletes function
User does not see function in group

User moves function to another group

User selects function as data source for a graph
User selects function as data source for a lua graph

User adds data point to tracker
Tracker is used as a data source for a function
graph using function as data source refreshes with new data point


Function screen: 

There's a fixed output node in the canvas. You can't remove it.
The output node has a configuration for the function: 
- name
- description
- whether it's a duration output


There's a done button FAB
When the function is valid the button is enabled, otherwise disabled
When clicked, saves the function and goes back to group screen

Nodes in canvas
Node size defined in canvas space
When editing function, camera zooms to fit all nodes in view

Long pressing anywhere on the canvas creates a new node at that position by bringing up the node picker
There are three node types: 
- Data source
- Prebuilt Lua functions
- Custom Lua code

Selecting a node type creates that node in the canvas
The node is a card with configuration on it
When the configuration for that node is invalid the node has a red border
A node card has a delete button, and a help button that shows a dialog explaining what the node does

Any node is a card, and it has handles on the left and right side for connecting to other nodes
Dragging from any handle creates a connection line that follows the finger using a bezier curve
Releasing the drag on another node's handle creates a connection between the two nodes
Releasing the drag anywhere else cancels the connection
Tapping a connection line highlights the line and shows a delete FAB button to remove the connection

Tapping outside of any node or connection line clears the selection
Dragging on the canvas pans the canvas
Pinching anywhere zooms in or out

There's a back button in the top left corner to go back to the group screen
Dragging or pinching hides all fabs and the back button
Tapping on anything/anywhere shows all relevant fabs and the back button







Prebuilt Lua function nodes:

- Duration clustered max
  - Threshold (duration enum)
  - Duration multiplier (uint)
- Duration clustered min
  - Threshold (duration enum)
  - Duration multiplier (uint)
- Duration clustered average
  - Threshold (duration enum)
  - Duration multiplier (uint)
- Duration clustered sum
  - Threshold (duration enum)
  - Duration multiplier (uint)

- Period clustered max
  - Threshold (period enum)
  - Period multiplier (uint)
- Period clustered min
  - Threshold (period enum)
  - Period multiplier (uint)
- Period clustered average
  - Threshold (period enum)
  - Period multiplier (uint)
- Period clustered sum
  - Threshold (period enum)
  - Period multiplier (uint)

- Pair and subctract
  - Threshold (duration)
  - Filter items without pairs (boolean)
- Pair and sum
  - Threshold (duration)
  - Filter items without pairs (boolean)
- Pair and multiply
  - Threshold (duration)
  - Filter items without pairs (boolean)
- Pair and divide
  - Threshold (duration)
  - Filter items without pairs (boolean)

- Time cutoff from instant
  - Cutoff time (instant)
- Time cutoff from duration ago
  - Cutoff duration (duration)
- Time cutoff from period ago
  - Cutoff period (period enum)
  - Period multiplier (uint)

- Cumulative sum (no config)
  - max data points (uint)
  - reset on 0 value (boolean)

- duration based Standard deviation
  - Window size (duration enum)
  - Duration multiplier (uint)
  - Moving window (boolean)
- duration based Variance
  - Window size (duration enum)
  - Duration multiplier (uint)
  - Moving window (boolean)
- duration based Average
  - Window size (duration enum)
  - Duration multiplier (uint)
  - Moving window (boolean)
- duration based Sum
  - Window size (duration enum)
  - Duration multiplier (uint)
  - Moving window (boolean)
- duration based Minimum
  - Window size (duration enum)
  - Duration multiplier (uint)
  - Moving window (boolean)
- duration based Maximum
  - Window size (duration enum)
  - Duration multiplier (uint)
  - Moving window (boolean)

- period based Standard deviation
  - Window size (period enum)
  - period multiplier (uint)
  - Moving window (boolean)
- period based Variance
  - Window size (period enum)
  - period multiplier (uint)
  - Moving window (boolean)
- period based Average
  - Window size (period enum)
  - period multiplier (uint)
  - Moving window (boolean)
- period based Sum
  - Window size (period enum)
  - period multiplier (uint)
  - Moving window (boolean)
- period based Minimum
  - Window size (period enum)
  - period multiplier (uint)
  - Moving window (boolean)
- period based Maximum
  - Window size (period enum)
  - period multiplier (uint)
  - Moving window (boolean)

- Synthetic Random data
  - seed (string)
  - frequency (duration)
  - jitter (duration)

- Snap to nearest time
  - time (local time)
- Snap to nearest week day
  - day of week (enum)
- Snap to nearest month day
  - day of month (number)
- Snap to next time 
  - time (local time)
- Snap to next week day
  - day of week (enum)
- Snap to next month day
  - day of month (number)
- Snap to next end of period
  - period (enum)

- Filter greater than other tracker
- Filter less than other tracker




Use cases: 

- weight where you have kg and lbs entries in the tracker
- total alcohol consumption per week by merging multiple trackers/labels
- the ratio of one tracker to another over time, e.g. gym to personal best ratio
- the time between events, e.g. time between workouts
- moving averages of weight over time
- filter outliers from weight data
- count of events per week
- combine multiple trackers into one graph
- 
